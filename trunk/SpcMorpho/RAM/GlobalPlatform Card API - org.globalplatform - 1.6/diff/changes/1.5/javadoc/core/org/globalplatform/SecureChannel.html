<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_30) on Thu Jan 24 18:02:01 CET 2013 -->
<TITLE>
SecureChannel
</TITLE>

<META NAME="date" CONTENT="2013-01-24">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="SecureChannel";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../org/globalplatform/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../org/globalplatform/Personalization.html" title="interface in org.globalplatform"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../org/globalplatform/SecureChannelx.html" title="interface in org.globalplatform"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?org/globalplatform/SecureChannel.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SecureChannel.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.globalplatform</FONT>
<BR>
Interface SecureChannel</H2>
<DL>
<DT><B>All Superinterfaces:</B> <DD>javacard.framework.Shareable</DD>
</DL>
<DL>
<DT><B>All Known Subinterfaces:</B> <DD><A HREF="../../org/globalplatform/SecureChannelx.html" title="interface in org.globalplatform">SecureChannelx</A>, <A HREF="../../org/globalplatform/SecureChannelx2.html" title="interface in org.globalplatform">SecureChannelx2</A></DD>
</DL>
<HR>
<DL>
<DT><PRE>public interface <B>SecureChannel</B><DT>extends javacard.framework.Shareable</DL>
</PRE>

<P>
This defines an interface to be used by an Application that may want to delegate the handling of entity 
 authentication and APDU security to its associated Security Domain. 
 This interface is designed to offer interoperability to the Application in that it requires no knowledge 
 of the mechanisms used to perform the authentication or of the scheme used for APDU security and shall allow 
 an Application to interface correctly with a Security Domain immaterial of the mechanisms or schemes used. 
 Prior to using this interface, an Application is required to obtain a handle to its associated Security Domain’s 
 SecureChannel interface object by invoking the <code>GPSystem.getSecureChannel()</code> method. 
 The SecureChannel interface shall only be exposed through the <code>GPSystem.getSecureChannel()</code> method.
 
 In all cases where the Application passes the APDU buffer as a parameter to the Security Domain, the class byte 
 of the APDU shall not be modified. This ensures that the Security Domain knows the logical channel number. 
 If the card supports logical channels, it is the responsibility of the Security Domain to correctly manage the 
 logical channel information when processing the APDU.
<P>

<P>
<DL>
<DT><B>Since:</B></DT>
  <DD>export file version 1.0</DD>
</DL>
<HR>

<P>
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#ANY_AUTHENTICATED">ANY_AUTHENTICATED</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entity Any Authentication has occurred (0x40).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#AUTHENTICATED">AUTHENTICATED</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entity Authentication has occurred  as Application Provider (0x80).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#C_DECRYPTION">C_DECRYPTION</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>unwrap</code> method will decrypt incoming command data (0x02).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#C_MAC">C_MAC</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>unwrap</code> method will verify the MAC on an incoming command (0x01).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#NO_SECURITY_LEVEL">NO_SECURITY_LEVEL</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entity Authentication has not occurred (0x00).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#R_ENCRYPTION">R_ENCRYPTION</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>wrap</code> method will encrypt the outgoing response data (0x20).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#R_MAC">R_MAC</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>wrap</code> method will generate a MAC for the outgoing response data (0x10).</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;short</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#decryptData(byte[], short, short)">decryptData</A></B>(byte[]&nbsp;baBuffer,
            short&nbsp;sOffset,
            short&nbsp;sLength)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method is used to decrypt data located in the input buffer.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;short</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#encryptData(byte[], short, short)">encryptData</A></B>(byte[]&nbsp;baBuffer,
            short&nbsp;sOffset,
            short&nbsp;sLength)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method is used to encrypt data located in the input buffer.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;byte</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#getSecurityLevel()">getSecurityLevel</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method returns, from the requester's standpoint, the Current Security Level coded 
 as a bit-map according to Table 10 1 indicating whether entity authentication has occurred and
  what level of security is currently applicable to command and response messages processed 
 by the <code>unwrap()</code> and <code>wrap()</code> methods.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;short</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#processSecurity(javacard.framework.APDU)">processSecurity</A></B>(javacard.framework.APDU&nbsp;apdu)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Processes security related APDU commands.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#resetSecurity()">resetSecurity</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method is used to reset all information relating to the current Secure Channel Session.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;short</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#unwrap(byte[], short, short)">unwrap</A></B>(byte[]&nbsp;baBuffer,
       short&nbsp;sOffset,
       short&nbsp;sLength)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method is used to process and verify the secure messaging of an incoming command according to the
 security level and Session Security Level of the current Secure Channel Session.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;short</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/globalplatform/SecureChannel.html#wrap(byte[], short, short)">wrap</A></B>(byte[]&nbsp;baBuffer,
     short&nbsp;sOffset,
     short&nbsp;sLength)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This method applies secure messaging to the current outgoing response according to the Current Security Level and 
 Session Security Level of the Secure Channel Session.</TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="AUTHENTICATED"><!-- --></A><H3>
AUTHENTICATED</H3>
<PRE>
static final byte <B>AUTHENTICATED</B></PRE>
<DL>
<DD>Entity Authentication has occurred  as Application Provider (0x80).
 <p>Note:<ul>
 <li><em>Entity Authentication and the level of security that will be applied by the <code>wrap</code>
 and <code>unwrap</code> methods are not necessarily related. A Security Domain, by default, could
 verify the MAC on any command passed as a parameter in the <code>unwrap</code> method without
 entity authentication previously having occurred.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.AUTHENTICATED">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="C_DECRYPTION"><!-- --></A><H3>
C_DECRYPTION</H3>
<PRE>
static final byte <B>C_DECRYPTION</B></PRE>
<DL>
<DD>The <code>unwrap</code> method will decrypt incoming command data (0x02).
 <p>Note:<ul>
 <li><em>Command data decryption could be indicated along with entity authentication and one or more
 levels of security.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.C_DECRYPTION">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="C_MAC"><!-- --></A><H3>
C_MAC</H3>
<PRE>
static final byte <B>C_MAC</B></PRE>
<DL>
<DD>The <code>unwrap</code> method will verify the MAC on an incoming command (0x01).
 <p>Note:<ul>
 <li><em>MAC verification could be indicated along with entity authentication and one or more
 levels of security, e.g. a value of '03' indicates that while entity authentication has not
 occurred, the <code>unwrap</code> method will decrypt the command data of incoming commands
 and verify the MAC on incoming commands.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.C_MAC">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="R_ENCRYPTION"><!-- --></A><H3>
R_ENCRYPTION</H3>
<PRE>
static final byte <B>R_ENCRYPTION</B></PRE>
<DL>
<DD>The <code>wrap</code> method will encrypt the outgoing response data (0x20).
 <p>Note:<ul>
 <li><em>Response data encryption could be indicated along with entity authentication and one
 or more levels of security.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.R_ENCRYPTION">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="R_MAC"><!-- --></A><H3>
R_MAC</H3>
<PRE>
static final byte <B>R_MAC</B></PRE>
<DL>
<DD>The <code>wrap</code> method will generate a MAC for the outgoing response data (0x10).
 <p>Note:<ul>
 <li><em>MAC generation could be indicated along with entity authentication and one or more
 levels of security, e.g. a value of '91' indicates that entity authentication has occurred,
 that the <code>unwrap</code> method will verify the MAC on incoming commands and that the
 <code>wrap</code> method will generate a MAC on outgoing response data.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.R_MAC">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="NO_SECURITY_LEVEL"><!-- --></A><H3>
NO_SECURITY_LEVEL</H3>
<PRE>
static final byte <B>NO_SECURITY_LEVEL</B></PRE>
<DL>
<DD>Entity Authentication has not occurred (0x00).
 <p>Note:<ul>
 <li><em>Entity Authentication and the level of security that will be applied by the
 <code>wrap</code> and <code>unwrap</code> methods are not necessarily related. A
 Security Domain, by default, could verify the MAC on any command passed as a parameter in
 the <code>unwrap</code> method without entity authentication previously having occurred.</em>
 <li><em>The <code>wrap</code> and <code>unwrap</code> methods will not apply any cryptographic
 processing to command or response data.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.NO_SECURITY_LEVEL">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="ANY_AUTHENTICATED"><!-- --></A><H3>
ANY_AUTHENTICATED</H3>
<PRE>
static final byte <B>ANY_AUTHENTICATED</B></PRE>
<DL>
<DD>Entity Any Authentication has occurred (0x40).
 <p>Note:<ul>
 Authenticated entity is not the Application Provider of the Application.
 The level of security that will be applied by the <code>wrap</code>
 and <code>unwrap</code> methods are not necessarily related. A Security Domain, by default, could
 verify the MAC on any command passed as a parameter in the <code>unwrap</code> method without
 entity authentication previously having occurred.</em>
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../constant-values.html#org.globalplatform.SecureChannel.ANY_AUTHENTICATED">Constant Field Values</A></DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="processSecurity(javacard.framework.APDU)"><!-- --></A><H3>
processSecurity</H3>
<PRE>
short <B>processSecurity</B>(javacard.framework.APDU&nbsp;apdu)
                      throws javacard.framework.ISOException</PRE>
<DL>
<DD>Processes security related APDU commands.
 <p>
 This method is used by an applet to process APDU commands that possibly relate to the security 
 mechanism used by the Security Domain. As the intention is to allow an Application to be associated 
 with a Security Domain without having any knowledge of the security mechanisms used by the Security 
 Domain, the applet assumes that APDU commands that it does not recognize are part of the security mechanism 
 and will be recognized by the Security Domain. The applet can either invoke this method prior to determining 
 if it recognizes the command or only invoke this method for commands it does not recognize.
 The method sets the compulsory Session Security Level that is established at Secure Channel initiation and 
 which is required for the whole Secure Channel Session. On successful initialization of the Secure Channel Session, 
 the Current Security Level is set to the same value as the compulsory Session Security Level. 
 The Current Security Level is updated (R-MAC or not) on the successful processing of the 
 BEGIN R-MAC SESSION / END R-MAC SESSION commands.
 
 <p>Notes:<ul>
 <li><em>Processing this method shall comply to the rules of the Secure Channel Protocol implemented by the Security Domain;</em>
 <li><em>The method is responsible for receiving the data field of commands that are recognized;</em>
 <li><em>The applet is responsible for recognizing commands that the method refused to process ('6E00' and '6D00');.</em>
 <li><em>The applet is responsible for outputting status  bytes returned due to the processing of instructions recognized by the method;</em>
 <li><em>If response data is present, this data will be placed in the <code>APDU</code> buffer at offset <code>ISO7816.OFFSET_CDATA</code>.
 The return code indicates the length and the applet is responsible for outputting this data.</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>apdu</CODE> - the incoming <code>APDU</code> object.
<DT><B>Returns:</B><DD>the number of bytes to be output.
<DT><B>Throws:</B>
<DD><CODE>javacard.framework.ISOException</CODE> - with the following reason codes (other security mechanism
 related status words may be returned):<ul>
 <li><code>ISO7816.SW_CLA_NOT_SUPPORTED</code> class byte is not recognized by the method.</li>
 <li><code>ISO7816.SW_INS_NOT_SUPPORTED</code> instruction byte is not recognized by the method.</li></DL>
</DD>
</DL>
<HR>

<A NAME="wrap(byte[], short, short)"><!-- --></A><H3>
wrap</H3>
<PRE>
short <B>wrap</B>(byte[]&nbsp;baBuffer,
           short&nbsp;sOffset,
           short&nbsp;sLength)
           throws java.lang.ArrayIndexOutOfBoundsException,
                  javacard.framework.ISOException</PRE>
<DL>
<DD>This method applies secure messaging to the current outgoing response according to the Current Security Level and 
 Session Security Level of the Secure Channel Session.
 <p>Notes:<ul>
 <li><em>Processing this method shall comply to the rules of the Secure Channel Protocol implemented by the Security Domain;</em>
 <li><em>This method attempts secure messaging processing of the current outgoing response when the Current Security Level indicates
 <code>R_MAC</code> and/or <code>R_ENCRYPTION</code>;</em>
 <li><em>If the Current Security Level does not indicate <code>R_MAC</code> and/or <code>R_ENCRYPTION</code>, when complying with the 
 Secure Channel Protocol rules, this method will do no processing and the outgoing response message will remain as is in the APDU object. 
 The returned length of the “wrapped” data is set to the value of the sLength parameter minus 2 (indicating the status  bytes are no 
 longer present at the end of the returned data);</em>
 <li><em>The applet is responsible for appending the expected status bytes at the end of the response data in order for them to be 
 protected by secure messaging;</em>
 <li><em>The returned data does not include the status  bytes;</em>
 <li><em>The method fails if the secure messaging of the incoming command is not successfully verified or does not match the 
 Current Security Level (as defined either as the compulsory Session Security Level set at initialization of the Secure Channel Session or
 as the Current Security Level set by the <code>setSecurityLevel()</code> method). 
 If the method fails, the Current Security Level is reset to <code>NO_SECURITY_LEVEL</code>, but not the compulsory Session Security Level;</em>
 <li><em>This method does not fail if a Secure Channel Session is not open (that is, when Session Security Level = <code>NO_SECURITY_LEVEL</code>) or 
 if the corresponding session keys are not available.</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>baBuffer</CODE> - the source of the data to be wrapped.<DD><CODE>sOffset</CODE> - the offset within <code>baBuffer</code> of the data to wrap.<DD><CODE>sLength</CODE> - the length of the data to wrap.
 <p>Notes:<ul>
 <li><em>The length Li of the Response Data Field is automatically calculated by the Security Domain and 
 prepended to the Response Data Field for computation of the R-MAC</em>.
 </ul>
<DT><B>Returns:</B><DD>the length of the wrapped data.
<DT><B>Throws:</B>
<DD><CODE>javacard.framework.ISOException</CODE> - <li>if security mechanism related status words might be returned.</li>
<DD><CODE>java.lang.ArrayIndexOutOfBoundsException</CODE> - <li>if wrapping produces data outside array bounds.</li>
<DD><CODE><code>java.lang.SecurityException</code><li></CODE> - if <code>baBuffer</code> is not accessible in the caller’s context 
 e.g. <code>baBuffer</code> is not a global array nor an array belonging to the caller context.</li></DL>
</DD>
</DL>
<HR>

<A NAME="unwrap(byte[], short, short)"><!-- --></A><H3>
unwrap</H3>
<PRE>
short <B>unwrap</B>(byte[]&nbsp;baBuffer,
             short&nbsp;sOffset,
             short&nbsp;sLength)
             throws javacard.framework.ISOException</PRE>
<DL>
<DD>This method is used to process and verify the secure messaging of an incoming command according to the
 security level and Session Security Level of the current Secure Channel Session.
 <p>Notes:<ul>
 <li><em>Processing this method shall comply to the rules of the Secure Channel Protocol implemented by the Security Domain;</em>
 <li><em>If <code>NO_SECURITY_LEVEL</code>, <code>AUTHENTICATED</code> or <code>ANY_AUTHENTICATED</code> only is indicated, 
 when complying to the Secure Channel Protocol rules, this method will not attempt any secure messaging processing on the incoming command, 
 the incoming command will remain as is within the incoming APDU object and the returned length of the “unwrapped” data is set to the value 
 of the sLength parameter, otherwise a security error is returned;</em>
 <li><em>If the class byte does not indicate secure messaging (according to ISO/IEC 7816-4), this method will not attempt any secure messaging 
 processing on the incoming command and the incoming command will remain as is within the incoming APDU object. 
 When complying with the Secure Channel Protocol rules, the returned length of the “unwrapped” data is set to the value of the sLength parameter
 otherwise a security error is returned;</em>
 <li><em>The applet is responsible for receiving the data field of the command;</em>
 <li><em>Correct secure messaging processing of the <code>unwrap()</code> will result in the incoming command being reformatted within the 
 incoming APDU object with all data relating to the secure messaging removed. 
 A reformatted case 1 or case 2 command will include an Lc byte set to zero;</em>
 <li><em>If R_MAC is indicated in the Current Security Level of the Secure Channel Session, once secure messaging processing of the incoming 
 command has successfully completed, R-MAC computation on the reformatted command (i.e. after all the data relating to secure messaging 
 has been removed) will be initiated. If no secure messaging processing was required for the incoming command, R-MAC computation will 
 be initiated on the unmodified incoming command, appended with a Lc byte of zero in event of a case 1 or case 2 command;</em>
 <li><em>Incorrect processing of the <code>unwrap</code> method will result in the information relating to the current Secure Channel being reset.
 <li><em>This method does not fail if a Secure Channel Session is not open (that is, when Session Security Level = <code>NO_SECURITY_LEVEL</code>) or
 if the corresponding session keys are not available;</em>
 <li><em>The method fails if the secure messaging of the incoming command is not successfully verified or 
 does not match the Current Security Level (as defined either as the compulsory Session Security Level set at 
 initialization of the Secure Channel Session or as the Current Security Level set by the <code>setSecurityLevel()</code> method). 
 If the method fails, the Current Security Level is reset to <code>NO_SECURITY_LEVEL</code>, but not the compulsory Session Security Level.</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>baBuffer</CODE> - the source of the data to be unwrapped.<DD><CODE>sOffset</CODE> - the offset within <code>baBuffer</code> of the APDU data to unwrap, i.e. the offset of the command header.<DD><CODE>sLength</CODE> - the length of the APDU data to unwrap, i.e the length of the command header and data field.
<DT><B>Returns:</B><DD>the length of the unwrapped data, i.e the length of the command header and data field.
<DT><B>Throws:</B>
<DD><CODE>javacard.framework.ISOException</CODE> - with the following reason code (other security mechanism related
 status words may be returned):<ul>
 <li><code>ISO7816.SW_SECURITY_STATUS_NOT_SATISFIED</code> if secure messaging verification failed.</li>
 <li><code>ISO7816.SW_CLA_NOT_SUPPORTED</code> class byte is not recognized by the method.</li></ul>
<DD><CODE><code>java.lang.SecurityException</code></CODE> - <li>if <code>baBuffer</code> is not accessible in the caller’s context 
 e.g. <code>baBuffer</code> is not a global array nor an array belonging to the caller context.</li></DL>
</DD>
</DL>
<HR>

<A NAME="decryptData(byte[], short, short)"><!-- --></A><H3>
decryptData</H3>
<PRE>
short <B>decryptData</B>(byte[]&nbsp;baBuffer,
                  short&nbsp;sOffset,
                  short&nbsp;sLength)
                  throws javacard.framework.ISOException</PRE>
<DL>
<DD>This method is used to decrypt data located in the input buffer.
 <p>Notes:<ul>
 <li><em>Processing this method shall comply to the rules of the Secure Channel Protocol 
 implemented by the Security Domain;</em>
 <li><em>The Security Domain implicitly knows the key to be used for decryption.</em>
 <li><em>The Security Domain is implicitly aware of any padding that may be present in the
 decrypted data and this is discarded.</em>
 <li><em>The clear text data replaces the ciphered data within the byte array. The removal
 of padding may cause the length of the clear text data to be shorter than the length of the ciphered data.</em>
 <li><em>The applet is responsible for checking the integrity of the decrypted data. </em>
 <li><em>A Secure Channel Session shall be opened and a sensitive data decryption key shall be available;</em>
 <li><em>This method fails if a Secure Channel Session is not open 
 (i.e. Session Security Level = NO_SECURITY_LEVEL) or if the corresponding session keys are not available.</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>baBuffer</CODE> - the source byte array.<DD><CODE>sOffset</CODE> - offset within the source byte array to start the decryption.<DD><CODE>sLength</CODE> - the number of bytes to decrypt.
<DT><B>Returns:</B><DD>The length of the clear text data.
<DT><B>Throws:</B>
<DD><CODE>javacard.framework.ISOException</CODE> - with the following reason codes:
 <li><code>ISO7816.SW_SECURITY_STATUS_NOT_SATISFIED</code> if a Secure Channel Session has not been opened.</li>
 <li><code>ISO7816.SW_WRONG_LENGTH</code> if the length of data to be decrypted is not valid.</li>
<DD><CODE><code>java.lang.SecurityException</code></CODE> - <li>if <code>baBuffer</code> is not accessible in the caller’s context 
 e.g. <code>baBuffer</code> is not a global array nor an array belonging to the caller context.</li></DL>
</DD>
</DL>
<HR>

<A NAME="encryptData(byte[], short, short)"><!-- --></A><H3>
encryptData</H3>
<PRE>
short <B>encryptData</B>(byte[]&nbsp;baBuffer,
                  short&nbsp;sOffset,
                  short&nbsp;sLength)
                  throws java.lang.ArrayIndexOutOfBoundsException</PRE>
<DL>
<DD>This method is used to encrypt data located in the input buffer.
 <p>Notes:<ul>
 <li><em>Processing this method shall comply to the rules of the Secure Channel Protocol 
 implemented by the Security Domain;</em>
 <li><em>The Security Domain is implicitly aware of any padding that must be applied to the
 clear text data prior to encryption according to the Secure Channel Protocol;</em>
 <li><em>The Security Domain implicitly knows the key to be used for encryption.</em>
 <li><em>The ciphered data replaces the clear text data within the byte array.</em>
 <li><em>A Secure Channel Session shall be opened and a sensitive data encryption key shall be available;</em>
 <li><em>This method fails if a Secure Channel Session is not open 
 (i.e. Session Security Level = NO_SECURITY_LEVEL) or if the corresponding session keys are not available.</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>baBuffer</CODE> - the byte array containing the data to be processed.<DD><CODE>sOffset</CODE> - offset within the byte array to start the encryption.<DD><CODE>sLength</CODE> - the number of bytes to encrypt.
<DT><B>Returns:</B><DD>The length of the encrypted data.
<DT><B>Throws:</B>
<DD><CODE>java.lang.ArrayIndexOutOfBoundsException</CODE> - <li>if enciphering produces data outside array bounds.</li>
<DD><CODE>javacard.framework.ISOException</CODE> - with the following reason code:
 <li><code>ISO7816.SW_SECURITY_STATUS_NOT_SATISFIED</code> if a Secure Channel Session is not open.</li>
<DD><CODE><code>java.lang.SecurityException</code><li></CODE> - if <code>baBuffer</code> is not accessible in the caller’s context 
 e.g. <code>baBuffer</code> is not a global array nor an array belonging to the caller context.</li></DL>
</DD>
</DL>
<HR>

<A NAME="resetSecurity()"><!-- --></A><H3>
resetSecurity</H3>
<PRE>
void <B>resetSecurity</B>()</PRE>
<DL>
<DD>This method is used to reset all information relating to the current Secure Channel Session.
 It resets both the compulsory Session Security Level and the Current Security Level to NO_SECURITY_LEVEL,
 terminates the current Secure Channel Session and erases all session keys.
 <p>Notes:<ul>
 <li><em>It is strongly recommended that applets using the services of a Security Domain invoke 
 this method in the <code>Applet.deselect()</code> method;</em>
 <li><em>The Security Domain will reset all information relating to the current Secure Channel, i.e.
 all Secure Channel session keys, state information and security level information will be erased.</em>
 <li><em>This method shall not fail if no Secure Channel has been initiated.</em>
 </ul>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getSecurityLevel()"><!-- --></A><H3>
getSecurityLevel</H3>
<PRE>
byte <B>getSecurityLevel</B>()</PRE>
<DL>
<DD>This method returns, from the requester's standpoint, the Current Security Level coded 
 as a bit-map according to Table 10 1 indicating whether entity authentication has occurred and
  what level of security is currently applicable to command and response messages processed 
 by the <code>unwrap()</code> and <code>wrap()</code> methods.
 <p>Notes:<ul>
 <li><em>Applets must invoke this method to ensure that application specific security requirements
 have been previously met or will be enforced by the Security Domain.</em>
 <li><em>More than one level of security may be active and these may change during a Secure
 Channel, e.g. an R_MAC session may be initiated during a C_MAC session.</em>
 <li><em>The Current Security Level may be different at the same time for an Application invoking 
 the method and its associated Security Domain depending on the Secure Channel Protocol and 
 the authenticated off-card entity's Application Provider ID (e.g. it may be ANY_AUTHENTICATED 
 for the application and AUTHENTICATED for its associated Security Domain).</em>
 </ul>
 <p>
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>

<DT><B>Returns:</B><DD><li><em>The current Security Level</em></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../org/globalplatform/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../org/globalplatform/Personalization.html" title="interface in org.globalplatform"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../org/globalplatform/SecureChannelx.html" title="interface in org.globalplatform"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?org/globalplatform/SecureChannel.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="SecureChannel.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;CONSTR&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
